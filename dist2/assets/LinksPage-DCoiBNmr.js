import{c as d,u as M,r as n,j as e,S as P}from"./index-o6bFHvLj.js";import{E as T,P as I,a as $}from"./ErrorBoundary-Bsc-wGX0.js";import{C as B,B as m,s as h}from"./supabase-fagYWzpQ.js";import{A as U}from"./alert-circle-DOA8E8do.js";import{C as q}from"./calendar-Bv2vKXy1.js";import{U as R}from"./users-SrOE9gwv.js";import{T as F}from"./trash-2-In6J1QqK.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=d("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=d("IndianRupee",[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=d("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=d("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),ee=()=>{const x=M(),[u,g]=n.useState([]),[N,v]=n.useState({}),[b,_]=n.useState(!0),[o,f]=n.useState(null);n.useEffect(()=>{(async()=>{try{const{data:t,error:c}=await h.from("ghu_links").select("*").order("created_at",{ascending:!1});if(c)throw c;const i=(t||[]).map(a=>{let r=[];return a.package_ids&&Array.isArray(a.package_ids)&&a.package_ids.length>0&&(typeof a.package_ids[0]=="string"?r=a.package_ids.map(p=>({id:p,tag:null})):r=a.package_ids),{...a,package_ids:r,departure_city:a.departure_city||""}}),y=Array.from(new Set(i.flatMap(a=>a.package_ids.map(r=>r.id))));if(y.length>0){const{data:a,error:r}=await h.from("ghu_packages").select(`
              *,
              operator:operator_id(name, city),
              airline:airline_id(name)
            `).in("id",y);if(r)throw r;const p=(a||[]).reduce((S,k)=>({...S,[k.id]:k}),{});v(p)}g(i)}catch(t){console.error("Error fetching data:",t)}finally{_(!1)}})()},[]);const j=()=>{x("/links/add")},L=s=>{x(`/links/edit/${s}`)},w=async s=>{if(confirm("Are you sure you want to delete this link?"))try{const{error:t}=await h.from("ghu_links").delete().eq("id",s);if(t)throw t;g(c=>c.filter(i=>i.id!==s)),l("Link deleted successfully","success")}catch(t){console.error("Error deleting link:",t),l("Failed to delete link","error")}},z=s=>{const t=`https://gohajjumrah.com/packages/${s}`;navigator.clipboard.writeText(t).then(()=>l("Link copied to clipboard","success")).catch(()=>l("Failed to copy link","error"))},l=(s,t)=>{f({message:s,type:t}),setTimeout(()=>f(null),3e3)},A=s=>{if(!s.start||!s.end)return"No dates selected";const t=new Date(s.start),c=new Date(s.end);return`${t.toLocaleDateString()} - ${c.toLocaleDateString()}`},C=s=>s?s.charAt(0).toUpperCase()+s.slice(1):"Not specified",D=s=>{switch(s){case"cheapest":return"bg-green-100 text-green-800";case"best value":return"bg-blue-100 text-blue-800";case"luxury":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},E=s=>e.jsx("div",{className:"space-y-1",children:s.map((t,c)=>{const i=N[t.id];return i?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:i.name}),t.tag&&e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${D(t.tag)}`,children:[e.jsx(W,{size:10,className:"mr-1"}),t.tag]})]},t.id):null})});return e.jsx(T,{children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx(I,{title:"Links",description:"Manage contact links and package assignments",onAddNew:j}),o&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg flex items-center ${o.type==="success"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[e.jsx(U,{className:"mr-2",size:20}),o.message]}),b?e.jsx("div",{className:"flex justify-center my-12",children:e.jsx(P,{size:"lg"})}):u.length===0?e.jsx($,{title:"No links found",description:"Get started by adding your first link",actionText:"Add Link",onAction:j}):e.jsx(B,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-4",children:"ID"}),e.jsx("th",{className:"text-left p-4",children:"Name"}),e.jsx("th",{className:"text-left p-4",children:"Phone"}),e.jsx("th",{className:"text-left p-4",children:"Departure City"}),e.jsx("th",{className:"text-left p-4",children:"Packages"}),e.jsx("th",{className:"text-left p-4",children:"Dates"}),e.jsx("th",{className:"text-left p-4",children:"Room Type"}),e.jsx("th",{className:"text-left p-4",children:"Budget"}),e.jsx("th",{className:"text-right p-4",children:"Actions"})]})}),e.jsx("tbody",{children:u.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-4 font-mono text-sm",children:s.short_id}),e.jsx("td",{className:"p-4",children:s.name}),e.jsx("td",{className:"p-4",children:e.jsx("a",{href:`tel:${s.phone}`,className:"text-primary hover:underline",children:s.phone})}),e.jsx("td",{className:"p-4",children:s.departure_city||"Not specified"}),e.jsx("td",{className:"p-4",children:E(s.package_ids)}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(q,{size:14,className:"mr-1"}),A(s.date_range)]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(R,{size:14,className:"mr-1"}),C(s.room_type)]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(G,{size:14,className:"mr-1"}),s.budget?s.budget.toLocaleString():"Not specified"]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>z(s.short_id),children:e.jsx(H,{size:16})}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>L(s.id),children:e.jsx(V,{size:16})}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>w(s.id),children:e.jsx(F,{size:16})})]})})]},s.id))})]})})})]})})};export{ee as default};
