import{a as U,u as S,r as l,j as e,S as k}from"./index-o6bFHvLj.js";import{B as p,C as E,a as _,s as d}from"./supabase-fagYWzpQ.js";import{U as I}from"./upload-LTZMtdKR.js";const F=()=>{const{id:n}=U(),c=S(),[j,v]=l.useState(!0),[u,x]=l.useState(!1),[m,h]=l.useState(!1),[b,g]=l.useState(null),[a,r]=l.useState({city:"",name:"",rating:0,reviewCount:0,address:"",phone:"",website:"",placeId:"",photoUrl:""});l.useEffect(()=>{n&&(async()=>{try{const{data:t,error:o}=await d.from("ghu_operators").select("*").eq("id",n).single();if(o)throw o;t&&r({city:t.city,name:t.name,rating:t.rating||0,reviewCount:t.review_count||0,address:t.address||"",phone:t.phone||"",website:t.website||"",placeId:t.place_id||"",photoUrl:t.photo_url||""})}catch(t){console.error("Error fetching operator:",t),g("Failed to load operator details")}finally{v(!1)}})()},[n]);const N=async s=>{var o;const t=(o=s.target.files)==null?void 0:o[0];if(t){x(!0);try{const i=`${a.placeId}-${Date.now()}.${t.name.split(".").pop()}`,{data:O,error:f}=await d.storage.from("operator-photos").upload(i,t,{contentType:t.type,upsert:!0});if(f)throw f;const{data:{publicUrl:y}}=d.storage.from("operator-photos").getPublicUrl(i);r(C=>({...C,photoUrl:y}))}catch(i){console.error("Error uploading photo:",i)}finally{x(!1)}}},w=async s=>{s.preventDefault(),h(!0);try{const{error:t}=await d.from("ghu_operators").update({city:a.city,name:a.name,rating:a.rating,review_count:a.reviewCount,address:a.address,phone:a.phone,website:a.website,photo_url:a.photoUrl,updated_at:new Date().toISOString()}).eq("id",n);if(t)throw t;c("/operators")}catch(t){console.error("Error updating operator:",t),g("Failed to update operator")}finally{h(!1)}};return j?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx(k,{size:"lg"})}):b?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-red-700",children:b}),e.jsx(p,{variant:"outline",className:"mt-4",onClick:()=>c("/operators"),children:"Go Back"})]})}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(E,{className:"max-w-2xl mx-auto",children:e.jsx(_,{children:e.jsxs("form",{onSubmit:w,children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Edit Operator"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"City"}),e.jsx("input",{type:"text",value:a.city,disabled:!0,className:"w-full p-2 border rounded-lg bg-slate-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:a.name,onChange:s=>r(t=>({...t,name:s.target.value})),className:"w-full p-2 border rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Rating"}),e.jsx("input",{type:"number",value:a.rating,onChange:s=>r(t=>({...t,rating:Number(s.target.value)})),className:"w-full p-2 border rounded-lg",step:"0.1",min:"0",max:"5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Review Count"}),e.jsx("input",{type:"number",value:a.reviewCount,onChange:s=>r(t=>({...t,reviewCount:Number(s.target.value)})),className:"w-full p-2 border rounded-lg",min:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Address"}),e.jsx("textarea",{value:a.address,onChange:s=>r(t=>({...t,address:s.target.value})),className:"w-full p-2 border rounded-lg",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:a.phone,onChange:s=>r(t=>({...t,phone:s.target.value})),className:"w-full p-2 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Website"}),e.jsx("input",{type:"url",value:a.website,onChange:s=>r(t=>({...t,website:s.target.value})),className:"w-full p-2 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Photo"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[a.photoUrl&&e.jsx("img",{src:a.photoUrl,alt:"Operator",className:"w-20 h-20 object-cover rounded-lg"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsxs("div",{className:"px-4 py-2 border rounded-lg hover:bg-slate-50 inline-flex items-center space-x-2",children:[e.jsx(I,{size:18}),e.jsx("span",{children:u?"Uploading...":"Upload Photo"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:N,className:"hidden",disabled:u})]})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-4",children:[e.jsx(p,{variant:"outline",onClick:()=>c("/operators"),disabled:m,children:"Cancel"}),e.jsx(p,{type:"submit",disabled:m,children:m?"Saving...":"Update Operator"})]})]})})})})};export{F as default};
