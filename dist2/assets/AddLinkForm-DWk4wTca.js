import{u as R,r as d,j as a}from"./index-o6bFHvLj.js";import{C as P,a as D,B as f,s as y}from"./supabase-fagYWzpQ.js";const j="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",k=()=>{let c="";for(let i=0;i<10;i++)c+=j.charAt(Math.floor(Math.random()*j.length));return c},E=[{value:"sharing",label:"Sharing"},{value:"quad",label:"Quad"},{value:"triple",label:"Triple"},{value:"double",label:"Double"},{value:"solo",label:"Solo"}],A=[{value:null,label:"No Tag"},{value:"cheapest",label:"Cheapest"},{value:"best value",label:"Best Value"},{value:"luxury",label:"Luxury"}],B=()=>{var b,p,x;const c=R(),[i,m]=d.useState(!1),[g,v]=d.useState([]),[o,N]=d.useState(""),[r,n]=d.useState({name:"",phone:"",packageIds:[],shortId:k(),departureCity:"",dateRange:{start:null,end:null},roomType:null,budget:null});d.useEffect(()=>{(async()=>{try{const t=y.from("ghu_packages").select(`
            *,
            operator:operator_id(name, city),
            airline:airline_id(name),
            mecca_hotel:mecca_hotel_id(name),
            madina_hotel:madina_hotel_id(name)
          `).order("created_at",{ascending:!1});o&&t.eq("operator.city",o);const{data:s,error:l}=await t;if(l)throw l;v(s||[])}catch(t){console.error("Error fetching packages:",t)}})()},[o]),d.useEffect(()=>{n(e=>({...e,departureCity:o}))},[o]);const S=async e=>{var t,s;e.preventDefault(),m(!0);try{const{error:l}=await y.from("ghu_links").insert({name:r.name,phone:r.phone,package_ids:r.packageIds,short_id:r.shortId,departure_city:r.departureCity,date_range:{start:(t=r.dateRange.start)==null?void 0:t.toISOString(),end:(s=r.dateRange.end)==null?void 0:s.toISOString()},room_type:r.roomType,budget:r.budget});if(l){if(l.code==="23505"){n(_=>({..._,shortId:k()}));return}throw l}c("/links")}catch(l){console.error("Error saving link:",l)}finally{m(!1)}},I=e=>{n(t=>t.packageIds.findIndex(l=>l.id===e)!==-1?{...t,packageIds:t.packageIds.filter(l=>l.id!==e)}:t.packageIds.length>=5?t:{...t,packageIds:[...t.packageIds,{id:e,tag:null}]})},C=(e,t)=>{n(s=>({...s,packageIds:s.packageIds.map(l=>l.id===e?{...l,tag:t}:l)}))},h=(e,t)=>{n(s=>({...s,dateRange:{...s.dateRange,[e]:t?new Date(t):null}}))},u=e=>r.packageIds.some(t=>t.id===e),w=e=>{const t=r.packageIds.find(s=>s.id===e);return(t==null?void 0:t.tag)||null},T=Array.from(new Set(g.map(e=>{var t;return(t=e.operator)==null?void 0:t.city}))).filter(Boolean);return a.jsx("div",{className:"container mx-auto px-4 py-8",children:a.jsx(P,{className:"max-w-2xl mx-auto",children:a.jsx(D,{children:a.jsxs("form",{onSubmit:S,className:"space-y-6",children:[a.jsx("h2",{className:"text-2xl font-poppins font-semibold text-black mb-6",children:"Add New Link"}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-2",children:"Name"}),a.jsx("input",{type:"text",value:r.name,onChange:e=>n(t=>({...t,name:e.target.value})),className:"w-full p-2 border rounded-lg bg-white focus:ring-2 focus:ring-primary focus:border-transparent",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-2",children:"Phone Number"}),a.jsx("input",{type:"tel",value:r.phone,onChange:e=>n(t=>({...t,phone:e.target.value})),className:"w-full p-2 border rounded-lg bg-white focus:ring-2 focus:ring-primary focus:border-transparent",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-2",children:"Preferred Date Range"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Start Date"}),a.jsx("input",{type:"date",value:((b=r.dateRange.start)==null?void 0:b.toISOString().split("T")[0])||"",onChange:e=>h("start",e.target.value),className:"w-full p-2 border rounded-lg bg-white focus:ring-2 focus:ring-primary focus:border-transparent",min:new Date().toISOString().split("T")[0]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"End Date"}),a.jsx("input",{type:"date",value:((p=r.dateRange.end)==null?void 0:p.toISOString().split("T")[0])||"",onChange:e=>h("end",e.target.value),className:"w-full p-2 border rounded-lg bg-white focus:ring-2 focus:ring-primary focus:border-transparent",min:((x=r.dateRange.start)==null?void 0:x.toISOString().split("T")[0])||new Date().toISOString().split("T")[0]})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-2",children:"Room Type"}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:E.map(({value:e,label:t})=>a.jsxs("label",{className:`
                      flex items-center justify-center p-2 rounded-lg cursor-pointer border
                      ${r.roomType===e?"bg-primary text-white border-primary":"bg-white text-black border-gray-200 hover:bg-gray"}
                    `,children:[a.jsx("input",{type:"radio",name:"roomType",value:e,checked:r.roomType===e,onChange:s=>n(l=>({...l,roomType:s.target.value})),className:"sr-only"}),a.jsx("span",{children:t})]},e))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-2",children:"Budget (₹)"}),a.jsx("input",{type:"number",value:r.budget??"",onChange:e=>n(t=>({...t,budget:e.target.value?parseInt(e.target.value):null})),className:"w-full p-2 border rounded-lg bg-white focus:ring-2 focus:ring-primary focus:border-transparent",min:"0",placeholder:"Enter your budget"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-2",children:"Filter by Departure City"}),a.jsxs("select",{value:o,onChange:e=>N(e.target.value),className:"w-full p-2 border rounded-lg bg-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[a.jsx("option",{value:"",children:"All Cities"}),T.map(e=>a.jsx("option",{value:e,children:e},e))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-2",children:"Select Packages (max 5)"}),a.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:g.map(e=>{var t;return a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:`
                        block p-3 border rounded-lg cursor-pointer transition-colors
                        ${u(e.id)?"bg-primary/10 border-primary":"hover:bg-gray border-gray-200"}
                        ${r.packageIds.length>=5&&!u(e.id)?"opacity-50 cursor-not-allowed":""}
                      `,children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",checked:u(e.id),onChange:()=>I(e.id),disabled:r.packageIds.length>=5&&!u(e.id),className:"rounded border-gray-300 text-primary focus:ring-primary mr-3"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-black",children:e.name}),a.jsxs("p",{className:"text-sm text-black/60",children:[(t=e.operator)==null?void 0:t.name," • ",e.package_type]})]})]})}),u(e.id)&&a.jsxs("div",{className:"ml-6 pl-3 border-l-2 border-primary/20",children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-1",children:"Package Tag"}),a.jsx("select",{value:w(e.id)||"",onChange:s=>C(e.id,s.target.value),className:"w-full p-2 border rounded-lg bg-white focus:ring-2 focus:ring-primary focus:border-transparent text-sm",children:A.map(({value:s,label:l})=>a.jsx("option",{value:s||"",children:l},s||"none"))})]})]},e.id)})}),a.jsxs("p",{className:"mt-2 text-sm text-black/60",children:[r.packageIds.length,"/5 packages selected"]})]}),a.jsxs("div",{className:"flex justify-end space-x-4",children:[a.jsx(f,{variant:"outline",onClick:()=>c("/links"),disabled:i,children:"Cancel"}),a.jsx(f,{type:"submit",disabled:i||r.packageIds.length===0,children:i?"Saving...":"Save Link"})]})]})})})})};export{B as default};
