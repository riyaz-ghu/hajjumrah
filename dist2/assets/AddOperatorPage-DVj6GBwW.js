import{u as M,r as l,j as e}from"./index-o6bFHvLj.js";import{L as R}from"./index-BturGVvf.js";import{C as $,a as W,B as N,s as h}from"./supabase-fagYWzpQ.js";import{S as K}from"./search-CuF8U8EO.js";import{U as Q}from"./upload-LTZMtdKR.js";const T=["Mumbai","Delhi","Bengaluru","Hyderabad"],V=()=>{const x=M(),[d,g]=l.useState("city"),[S,C]=l.useState(""),[P,_]=l.useState(""),[b,m]=l.useState([]),[f,U]=l.useState(null),[v,I]=l.useState(null),[k,i]=l.useState(!1),[a,o]=l.useState({city:"",name:"",rating:0,reviewCount:0,address:"",phone:"",website:"",placeId:"",photoUrl:""}),[j,w]=l.useState(!1),[p,y]=l.useState(!1);l.useEffect(()=>{(async()=>{const s=new R({apiKey:"AIzaSyCWh1e1w6S7Y0MCt4yo_68kSUUsILnDM5E",version:"weekly",libraries:["places"]});try{await s.load();const r=new google.maps.Map(document.createElement("div"));U(new google.maps.places.PlacesService(r)),I(new google.maps.places.AutocompleteService)}catch(r){console.error("Error loading Google Places API:",r)}})()},[]);const E=t=>{C(t),o(s=>({...s,city:t})),g("search")},A=async t=>{if(_(t),i(!0),!v||t.length<3){m([]),i(!1);return}try{const s=await v.getPlacePredictions({input:t,componentRestrictions:{country:"IN"},types:["establishment"],locationBias:{radius:5e4,center:{lat:0,lng:0}}});m(s.predictions.map(r=>({place_id:r.place_id,description:r.description})))}catch(s){console.error("Error fetching place predictions:",s),m([])}finally{i(!1)}},D=async t=>{if(f){i(!0);try{const s=await new Promise((r,n)=>{f.getDetails({placeId:t,fields:["name","rating","user_ratings_total","formatted_address","formatted_phone_number","website"]},(u,c)=>{c===google.maps.places.PlacesServiceStatus.OK&&u?r(u):n(new Error(`Place details request failed: ${c}`))})});o(r=>({...r,placeId:t,name:s.name||"",rating:s.rating||0,reviewCount:s.user_ratings_total||0,address:s.formatted_address||"",phone:s.formatted_phone_number||"",website:s.website||"",photoUrl:""})),g("form")}catch(s){console.error("Error fetching place details:",s)}finally{i(!1)}}},O=async t=>{var r;const s=(r=t.target.files)==null?void 0:r[0];if(s){w(!0);try{const n=`${a.placeId}-${Date.now()}.${s.name.split(".").pop()}`,{data:u,error:c}=await h.storage.from("operator-photos").upload(n,s,{contentType:s.type,upsert:!0});if(c)throw c;const{data:{publicUrl:L}}=h.storage.from("operator-photos").getPublicUrl(n);o(B=>({...B,photoUrl:L}))}catch(n){console.error("Error uploading photo:",n)}finally{w(!1)}}},z=async t=>{t.preventDefault(),y(!0);try{const{data:s,error:r}=await h.from("ghu_operators").insert([{city:a.city,name:a.name,rating:a.rating,review_count:a.reviewCount,address:a.address,phone:a.phone,website:a.website,place_id:a.placeId,photo_url:a.photoUrl}]).select().single();if(r)throw r;x("/operators")}catch(s){console.error("Error saving operator:",s)}finally{y(!1)}};return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx($,{className:"max-w-2xl mx-auto",children:e.jsxs(W,{children:[d==="city"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Select City"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:T.map(t=>e.jsx("button",{onClick:()=>E(t),className:"p-4 text-left border rounded-lg hover:border-emerald-500 hover:bg-emerald-50 transition-colors",children:t},t))})]}),d==="search"&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Search Operator in ",S]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center border rounded-lg overflow-hidden focus-within:ring-2 focus-within:ring-emerald-500 focus-within:border-transparent",children:[e.jsx("input",{type:"text",value:P,onChange:t=>A(t.target.value),placeholder:"Search for operator...",className:"flex-1 p-3 outline-none"}),k?e.jsx("div",{className:"mr-3",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-emerald-500 border-t-transparent"})}):e.jsx(K,{className:"w-5 h-5 mr-3 text-slate-400"})]}),b.length>0&&e.jsx("div",{className:"fixed left-0 right-0 mt-1 mx-4 bg-white border rounded-lg shadow-lg max-h-60 overflow-y-auto",style:{zIndex:1e3,maxWidth:"calc(100% - 2rem)",width:"100%"},children:b.map(t=>e.jsx("button",{onClick:()=>D(t.place_id),className:"w-full p-3 text-left hover:bg-slate-50 border-b last:border-b-0",children:e.jsx("p",{className:"text-sm font-medium text-slate-900",children:t.description})},t.place_id))})]})]}),d==="form"&&e.jsxs("form",{onSubmit:z,children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Operator Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:a.name,onChange:t=>o(s=>({...s,name:t.target.value})),className:"w-full p-2 border rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Rating"}),e.jsx("input",{type:"number",value:a.rating,onChange:t=>o(s=>({...s,rating:Number(t.target.value)})),className:"w-full p-2 border rounded-lg",step:"0.1",min:"0",max:"5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Review Count"}),e.jsx("input",{type:"number",value:a.reviewCount,onChange:t=>o(s=>({...s,reviewCount:Number(t.target.value)})),className:"w-full p-2 border rounded-lg",min:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Address"}),e.jsx("textarea",{value:a.address,onChange:t=>o(s=>({...s,address:t.target.value})),className:"w-full p-2 border rounded-lg",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:a.phone,onChange:t=>o(s=>({...s,phone:t.target.value})),className:"w-full p-2 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Website"}),e.jsx("input",{type:"url",value:a.website,onChange:t=>o(s=>({...s,website:t.target.value})),className:"w-full p-2 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Photo"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[a.photoUrl&&e.jsx("img",{src:a.photoUrl,alt:"Operator",className:"w-20 h-20 object-cover rounded-lg"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsxs("div",{className:"px-4 py-2 border rounded-lg hover:bg-slate-50 inline-flex items-center space-x-2",children:[e.jsx(Q,{size:18}),e.jsx("span",{children:j?"Uploading...":"Upload Photo"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:O,className:"hidden",disabled:j})]})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-4",children:[e.jsx(N,{variant:"outline",onClick:()=>x("/operators"),disabled:p,children:"Cancel"}),e.jsx(N,{type:"submit",disabled:p,children:p?"Saving...":"Save Operator"})]})]})]})})})};export{V as default};
