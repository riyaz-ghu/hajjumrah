import{c as b,u as A,r as n,j as e,S as z}from"./index-o6bFHvLj.js";import{E as C,P as q,a as M}from"./ErrorBoundary-Bsc-wGX0.js";import{C as T,a as $,B as h,s as i}from"./supabase-fagYWzpQ.js";import{A as B}from"./alert-circle-DOA8E8do.js";import{C as D}from"./calendar-Bv2vKXy1.js";import{P as H}from"./plane-rrSPSyLR.js";import{B as L}from"./building-2-DCJzLkBV.js";import{T as F}from"./trash-2-In6J1QqK.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=b("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=b("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),V=()=>{const d=A(),[g,f]=n.useState([]),[P,_]=n.useState(!0),[u,p]=n.useState(null),[o,j]=n.useState(null);n.useEffect(()=>{(async()=>{try{const{data:s,error:r}=await i.from("ghu_packages").select(`
            *,
            operator:operator_id(name),
            airline:airline_id(name),
            mecca_hotel:mecca_hotel_id(name),
            madina_hotel:madina_hotel_id(name)
          `).order("created_at",{ascending:!1});if(r)throw r;f(s||[])}catch(s){console.error("Error fetching packages:",s),m("Failed to load packages","error")}finally{_(!1)}})()},[]);const m=(a,s)=>{j({message:a,type:s}),setTimeout(()=>j(null),5e3)},y=()=>{d("/packages/add")},v=a=>{d(`/packages/${a}/edit`)},w=a=>{d(`/packages/${a}/pricing`)},E=async(a,s)=>{const r=`Are you sure you want to delete "${s}"?

This will also delete:
- All pricing data for this package
- Any links associated with this package

This action cannot be undone.`;if(confirm(r)){p(a);try{const{error:t}=await i.from("ghu_pricing").delete().eq("package_id",a);t&&console.warn("Error deleting pricing data:",t);const{data:x,error:k}=await i.from("ghu_links").select("id, package_ids").filter("package_ids","@>",JSON.stringify([a]));if(k)console.warn("Error fetching links:",k);else if(x&&x.length>0)for(const l of x){const c=l.package_ids.filter(S=>S!==a);c.length===0?await i.from("ghu_links").delete().eq("id",l.id):await i.from("ghu_links").update({package_ids:c}).eq("id",l.id)}const{error:N}=await i.from("ghu_packages").delete().eq("id",a);if(N)throw N;f(l=>l.filter(c=>c.id!==a)),m(`Package "${s}" deleted successfully`,"success")}catch(t){console.error("Error deleting package:",t),m("Failed to delete package. Please try again.","error")}finally{p(null)}}};return e.jsx(C,{children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx(q,{title:"Packages",description:"Manage Umrah travel packages and offerings",onAddNew:y}),o&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg flex items-center ${o.type==="success"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[e.jsx(B,{className:"mr-2",size:20}),o.message]}),P?e.jsx("div",{className:"flex justify-center my-12",children:e.jsx(z,{size:"lg"})}):g.length===0?e.jsx(M,{title:"No packages found",description:"Get started by adding your first Umrah package",actionText:"Add Package",onAction:y}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:g.map(a=>{var s,r;return e.jsx(T,{className:"h-full",children:e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-slate-900",children:a.name}),e.jsx("span",{className:`
                      px-2 py-1 text-xs font-medium rounded-full
                      ${a.package_type==="Premium"?"bg-amber-100 text-amber-800":a.package_type==="Comfort"?"bg-emerald-100 text-emerald-800":"bg-blue-100 text-blue-800"}
                    `,children:a.package_type})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center text-slate-600",children:[e.jsx(D,{size:16,className:"mr-2"}),e.jsxs("span",{children:[a.duration," days"]})]}),e.jsxs("div",{className:"flex items-center text-slate-600",children:[e.jsx(H,{size:16,className:"mr-2"}),e.jsx("span",{children:a.airline.name})]}),e.jsxs("div",{className:"flex items-center text-slate-600",children:[e.jsx(L,{size:16,className:"mr-2"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{children:["Mecca: ",a.mecca_hotel.name]}),e.jsxs("span",{children:["Madina: ",a.madina_hotel.name]})]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-900 mb-2",children:"Inclusions:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(s=a.inclusions.standard)==null?void 0:s.map(t=>e.jsx("span",{className:"px-2 py-1 bg-slate-100 text-slate-700 rounded-full text-xs",children:t},t)),(r=a.inclusions.special)==null?void 0:r.map(t=>e.jsx("span",{className:"px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs",children:t},t))]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-2",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>v(a.id),children:[e.jsx(G,{size:16,className:"mr-1"}),"Edit"]}),e.jsxs(h,{size:"sm",onClick:()=>w(a.id),children:[e.jsx(U,{size:16,className:"mr-1"}),"Pricing"]}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>E(a.id,a.name),disabled:u===a.id,className:"text-red-600 border-red-200 hover:bg-red-50 hover:border-red-300",children:u===a.id?e.jsx("div",{className:"w-4 h-4 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}):e.jsx(F,{size:16})})]})]})},a.id)})})]})})};export{V as default};
