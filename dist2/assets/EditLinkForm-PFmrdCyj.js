import{a as E,u as P,r as i,j as a}from"./index-o6bFHvLj.js";import{C as R,a as O,B as N,s as m}from"./supabase-fagYWzpQ.js";const q=[{value:"sharing",label:"Sharing"},{value:"quad",label:"Quad"},{value:"triple",label:"Triple"},{value:"double",label:"Double"},{value:"solo",label:"Solo"}],A=[{value:null,label:"No Tag"},{value:"cheapest",label:"Cheapest"},{value:"best value",label:"Best Value"},{value:"luxury",label:"Luxury"}],F=()=>{var y,k,j;const{id:c}=E(),p=P(),[u,h]=i.useState(!1),[b,_]=i.useState([]),[d,x]=i.useState(""),[n,l]=i.useState({name:"",phone:"",packageIds:[],shortId:"",departureCity:"",dateRange:{start:null,end:null},roomType:null,budget:null});i.useEffect(()=>{(async()=>{var t,s;if(c)try{const{data:r,error:v}=await m.from("ghu_links").select("*").eq("id",c).single();if(v)throw v;if(r){let g=[];r.package_ids&&Array.isArray(r.package_ids)&&r.package_ids.length>0&&(typeof r.package_ids[0]=="string"?g=r.package_ids.map(D=>({id:D,tag:null})):g=r.package_ids),l({name:r.name,phone:r.phone,packageIds:g,shortId:r.short_id||"",departureCity:r.departure_city||"",dateRange:{start:(t=r.date_range)!=null&&t.start?new Date(r.date_range.start):null,end:(s=r.date_range)!=null&&s.end?new Date(r.date_range.end):null},roomType:r.room_type,budget:r.budget}),r.departure_city&&x(r.departure_city)}}catch(r){console.error("Error fetching link:",r)}})()},[c]),i.useEffect(()=>{(async()=>{try{const t=m.from("ghu_packages").select(`
            *,
            operator:operator_id(name, city),
            airline:airline_id(name),
            mecca_hotel:mecca_hotel_id(name),
            madina_hotel:madina_hotel_id(name)
          `).order("created_at",{ascending:!1});d&&t.eq("operator.city",d);const{data:s,error:r}=await t;if(r)throw r;_(s||[])}catch(t){console.error("Error fetching packages:",t)}})()},[d]),i.useEffect(()=>{l(e=>({...e,departureCity:d}))},[d]);const w=e=>{l(t=>t.packageIds.findIndex(r=>r.id===e)!==-1?{...t,packageIds:t.packageIds.filter(r=>r.id!==e)}:t.packageIds.length>=5?t:{...t,packageIds:[...t.packageIds,{id:e,tag:null}]})},S=(e,t)=>{l(s=>({...s,packageIds:s.packageIds.map(r=>r.id===e?{...r,tag:t}:r)}))},f=(e,t)=>{l(s=>({...s,dateRange:{...s.dateRange,[e]:t?new Date(t):null}}))},I=async e=>{var t,s;if(e.preventDefault(),!!c){h(!0);try{const{error:r}=await m.from("ghu_links").update({name:n.name,phone:n.phone,package_ids:n.packageIds,departure_city:n.departureCity,date_range:{start:(t=n.dateRange.start)==null?void 0:t.toISOString(),end:(s=n.dateRange.end)==null?void 0:s.toISOString()},room_type:n.roomType,budget:n.budget}).eq("id",c);if(r)throw r;p("/links")}catch(r){console.error("Error updating link:",r)}finally{h(!1)}}},o=e=>n.packageIds.some(t=>t.id===e),C=e=>{const t=n.packageIds.find(s=>s.id===e);return(t==null?void 0:t.tag)||null},T=Array.from(new Set(b.map(e=>{var t;return(t=e.operator)==null?void 0:t.city}))).filter(Boolean);return a.jsx("div",{className:"container mx-auto px-4 py-8",children:a.jsx(R,{className:"max-w-2xl mx-auto",children:a.jsx(O,{children:a.jsxs("form",{onSubmit:I,className:"space-y-6",children:[a.jsx("h2",{className:"text-2xl font-poppins font-semibold text-black mb-6",children:"Edit Link"}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-2",children:"Name"}),a.jsx("input",{type:"text",value:n.name,onChange:e=>l(t=>({...t,name:e.target.value})),className:"w-full p-2 border rounded-lg bg-white focus:ring-2 focus:ring-primary focus:border-transparent",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-2",children:"Phone Number"}),a.jsx("input",{type:"tel",value:n.phone,onChange:e=>l(t=>({...t,phone:e.target.value})),className:"w-full p-2 border rounded-lg bg-white focus:ring-2 focus:ring-primary focus:border-transparent",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-2",children:"Preferred Date Range"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Start Date"}),a.jsx("input",{type:"date",value:((y=n.dateRange.start)==null?void 0:y.toISOString().split("T")[0])||"",onChange:e=>f("start",e.target.value),className:"w-full p-2 border rounded-lg bg-white focus:ring-2 focus:ring-primary focus:border-transparent",min:new Date().toISOString().split("T")[0]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"End Date"}),a.jsx("input",{type:"date",value:((k=n.dateRange.end)==null?void 0:k.toISOString().split("T")[0])||"",onChange:e=>f("end",e.target.value),className:"w-full p-2 border rounded-lg bg-white focus:ring-2 focus:ring-primary focus:border-transparent",min:((j=n.dateRange.start)==null?void 0:j.toISOString().split("T")[0])||new Date().toISOString().split("T")[0]})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-2",children:"Room Type"}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:q.map(({value:e,label:t})=>a.jsxs("label",{className:`
                      flex items-center justify-center p-2 rounded-lg cursor-pointer border
                      ${n.roomType===e?"bg-primary text-white border-primary":"bg-white text-black border-gray-200 hover:bg-gray"}
                    `,children:[a.jsx("input",{type:"radio",name:"roomType",value:e,checked:n.roomType===e,onChange:s=>l(r=>({...r,roomType:s.target.value})),className:"sr-only"}),a.jsx("span",{children:t})]},e))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-2",children:"Budget (₹)"}),a.jsx("input",{type:"number",value:n.budget??"",onChange:e=>l(t=>({...t,budget:e.target.value?parseInt(e.target.value):null})),className:"w-full p-2 border rounded-lg bg-white focus:ring-2 focus:ring-primary focus:border-transparent",min:"0",placeholder:"Enter your budget"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-2",children:"Filter by Departure City"}),a.jsxs("select",{value:d,onChange:e=>x(e.target.value),className:"w-full p-2 border rounded-lg bg-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[a.jsx("option",{value:"",children:"All Cities"}),T.map(e=>a.jsx("option",{value:e,children:e},e))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-2",children:"Select Packages (max 5)"}),a.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:b.map(e=>{var t;return a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:`
                        block p-3 border rounded-lg cursor-pointer transition-colors
                        ${o(e.id)?"bg-primary/10 border-primary":"hover:bg-gray border-gray-200"}
                        ${n.packageIds.length>=5&&!o(e.id)?"opacity-50 cursor-not-allowed":""}
                      `,children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",checked:o(e.id),onChange:()=>w(e.id),disabled:n.packageIds.length>=5&&!o(e.id),className:"rounded border-gray-300 text-primary focus:ring-primary mr-3"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-black",children:e.name}),a.jsxs("p",{className:"text-sm text-black/60",children:[(t=e.operator)==null?void 0:t.name," • ",e.package_type]})]})]})}),o(e.id)&&a.jsxs("div",{className:"ml-6 pl-3 border-l-2 border-primary/20",children:[a.jsx("label",{className:"block text-sm font-medium text-black mb-1",children:"Package Tag"}),a.jsx("select",{value:C(e.id)||"",onChange:s=>S(e.id,s.target.value),className:"w-full p-2 border rounded-lg bg-white focus:ring-2 focus:ring-primary focus:border-transparent text-sm",children:A.map(({value:s,label:r})=>a.jsx("option",{value:s||"",children:r},s||"none"))})]})]},e.id)})}),a.jsxs("p",{className:"mt-2 text-sm text-black/60",children:[n.packageIds.length,"/5 packages selected"]})]}),a.jsxs("div",{className:"flex justify-end space-x-4",children:[a.jsx(N,{variant:"outline",onClick:()=>p("/links"),disabled:u,children:"Cancel"}),a.jsx(N,{type:"submit",disabled:u||n.packageIds.length===0,children:u?"Saving...":"Save Changes"})]})]})})})})};export{F as default};
